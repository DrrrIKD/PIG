version: 2.1

jobs:
  build-apk:
    docker:
      - image: kivy/buildozer
    steps:
      - checkout
      - run:
          name: Установка дополнительных зависимостей
          command: |
            sudo apt-get update && sudo apt-get install -y \
            python3-pip libffi-dev libssl-dev wget unzip
      - run:
          name: Предварительная загрузка Android SDK и NDK
          command: |
            mkdir -p ~/.buildozer/android/platform
            wget https://dl.google.com/android/repository/android-ndk-r25c-linux.zip -O ndk.zip
            unzip ndk.zip -d ~/.buildozer/android/platform
            rm ndk.zip
      - run:
          name: Сборка APK
          command: |
            buildozer -v android debug
      - persist_to_workspace:
          root: .
          paths:
            - bin/*.apk

workflows:
  build-and-deploy:
    jobs:
      - build-apk
